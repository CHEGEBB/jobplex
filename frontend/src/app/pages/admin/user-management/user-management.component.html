<div class="flex h-screen overflow-hidden">
  <!-- Sidebar -->
  <app-sidebar-admin class="w-64 flex-shrink-0 h-full z-10 hidden md:block"></app-sidebar-admin>
  <app-sidebar-admin class="w-full flex-shrink-0 h-16 z-10 fixed top-0 left-0 md:hidden"></app-sidebar-admin>

  <!-- Main Content Area -->
  <div class="flex-1 overflow-y-auto bg-slate-50 pb-8 md:ml-0 mt-16 md:mt-0">
    <!-- Header Section -->
    <div class="header-section p-4 lg:p-6 sticky top-0 bg-white shadow-sm z-10 rounded-b-xl">
      <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
        <div>
          <h1 class="text-2xl lg:text-3xl font-bold text-gray-800">User Management</h1>
          <p class="text-gray-600 mt-1">Manage platform users, roles, and permissions</p>
        </div>
        <div class="flex flex-col sm:flex-row gap-3 w-full lg:w-auto">
          <div class="search-container relative flex-grow max-w-md">
            <input 
              type="text" 
              placeholder="Search users..." 
              class="block w-full py-2.5 pl-10 pr-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600 focus:ring-1 focus:ring-purple-600"
              [(ngModel)]="searchTerm"
              (input)="filterUsers()">
            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
          </div>
          <button 
            (click)="toggleBulkActions()" 
            class="bulk-action-btn py-2.5 px-4 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors duration-200">
            <i class="fas fa-tasks mr-2"></i>Bulk Actions
          </button>
          <button 
            (click)="showAddUserModal()" 
            class="add-user-btn py-2.5 px-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors duration-200 flex items-center justify-center">
            <i class="fas fa-user-plus mr-2"></i>Add User
          </button>
        </div>
      </div>

      <!-- Filters Section -->
      <div class="filters-section mt-4 flex flex-wrap gap-3">
        <select 
          [(ngModel)]="filterRole" 
          (change)="filterUsers()" 
          class="filter-select py-2 px-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600 focus:ring-1 focus:ring-purple-600 bg-white">
          <option value="all">All Roles</option>
          <option value="jobseeker">Job Seeker</option>
          <option value="employer">Employer</option>
          <option value="admin">Admin</option>
        </select>
        <select 
          [(ngModel)]="filterStatus" 
          (change)="filterUsers()" 
          class="filter-select py-2 px-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600 focus:ring-1 focus:ring-purple-600 bg-white">
          <option value="all">All Status</option>
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
          <option value="pending">Pending Verification</option>
          <option value="suspended">Suspended</option>
        </select>
        <select 
          [(ngModel)]="filterVerified" 
          (change)="filterUsers()" 
          class="filter-select py-2 px-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600 focus:ring-1 focus:ring-purple-600 bg-white">
          <option value="all">All Verification</option>
          <option value="verified">Verified</option>
          <option value="unverified">Unverified</option>
        </select>
        <button 
          (click)="resetFilters()" 
          class="reset-filters-btn py-2 px-4 text-purple-600 hover:bg-purple-50 border border-purple-600 rounded-lg transition-colors duration-200">
          <i class="fas fa-sync-alt mr-2"></i>Reset
        </button>
      </div>

      <!-- Bulk Actions Panel (Conditional Display) -->
      <div *ngIf="showBulkPanel" class="bulk-actions-panel mt-4 p-4 bg-white rounded-lg shadow-md animate-fadeIn">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
          <p class="text-gray-700 mb-3 sm:mb-0">{{selectedUsers.length}} users selected</p>
          <div class="flex gap-2 flex-wrap">
            <button 
              [disabled]="selectedUsers.length === 0" 
              (click)="bulkVerify()" 
              class="bulk-btn py-1.5 px-3 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-check-circle mr-1"></i>Verify
            </button>
            <button 
              [disabled]="selectedUsers.length === 0" 
              (click)="bulkActivate()" 
              class="bulk-btn py-1.5 px-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-play-circle mr-1"></i>Activate
            </button>
            <button 
              [disabled]="selectedUsers.length === 0" 
              (click)="bulkSuspend()" 
              class="bulk-btn py-1.5 px-3 bg-yellow-500 text-white rounded-md hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-pause-circle mr-1"></i>Suspend
            </button>
            <button 
              [disabled]="selectedUsers.length === 0" 
              (click)="bulkDelete()" 
              class="bulk-btn py-1.5 px-3 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-trash-alt mr-1"></i>Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard Stats Cards -->
    <div class="stats-cards px-4 lg:px-6 mt-6">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="stat-card bg-white rounded-lg p-5 shadow-md border-l-4 border-purple-600 transition-transform hover:scale-[1.02]">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-gray-500 text-sm">Total Users</p>
              <h3 class="text-2xl font-bold text-gray-800 mt-1">{{totalUsers}}</h3>
              <p class="text-xs text-green-600 mt-1"><i class="fas fa-arrow-up mr-1"></i>12% this month</p>
            </div>
            <div class="icon-circle bg-purple-100 p-3 rounded-full">
              <i class="fas fa-users text-purple-600 text-xl"></i>
            </div>
          </div>
        </div>
        
        <div class="stat-card bg-white rounded-lg p-5 shadow-md border-l-4 border-blue-500 transition-transform hover:scale-[1.02]">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-gray-500 text-sm">Active Users</p>
              <h3 class="text-2xl font-bold text-gray-800 mt-1">{{activeUsers}}</h3>
              <p class="text-xs text-green-600 mt-1"><i class="fas fa-arrow-up mr-1"></i>8% this month</p>
            </div>
            <div class="icon-circle bg-blue-100 p-3 rounded-full">
              <i class="fas fa-user-check text-blue-500 text-xl"></i>
            </div>
          </div>
        </div>
        
        <div class="stat-card bg-white rounded-lg p-5 shadow-md border-l-4 border-yellow-500 transition-transform hover:scale-[1.02]">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-gray-500 text-sm">Pending Verification</p>
              <h3 class="text-2xl font-bold text-gray-800 mt-1">{{pendingUsers}}</h3>
              <p class="text-xs text-red-600 mt-1"><i class="fas fa-arrow-up mr-1"></i>15% this month</p>
            </div>
            <div class="icon-circle bg-yellow-100 p-3 rounded-full">
              <i class="fas fa-user-clock text-yellow-500 text-xl"></i>
            </div>
          </div>
        </div>
        
        <div class="stat-card bg-white rounded-lg p-5 shadow-md border-l-4 border-red-500 transition-transform hover:scale-[1.02]">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-gray-500 text-sm">Suspended Accounts</p>
              <h3 class="text-2xl font-bold text-gray-800 mt-1">{{suspendedUsers}}</h3>
              <p class="text-xs text-red-600 mt-1"><i class="fas fa-arrow-down mr-1"></i>3% this month</p>
            </div>
            <div class="icon-circle bg-red-100 p-3 rounded-full">
              <i class="fas fa-user-slash text-red-500 text-xl"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Table -->
    <div class="users-table-container px-4 lg:px-6 overflow-x-auto">
      <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <!-- Debug section -->
        <div *ngIf="filteredUsers.length === 0 && users.length > 0" class="p-4 bg-yellow-100 text-yellow-800 border-b border-yellow-200">
          <p><i class="fas fa-exclamation-triangle mr-2"></i> Users found but filtered out. Try resetting filters.</p>
          <button (click)="resetFilters()" class="mt-2 px-3 py-1 bg-yellow-200 rounded-md hover:bg-yellow-300">Reset Filters</button>
        </div>
      
        <table class="min-w-full table-auto">
          <thead class="bg-gray-50 border-b border-gray-200">
            <tr>
              <th class="px-4 py-4 text-left">
                <div class="flex items-center">
                  <input 
                    type="checkbox" 
                    [checked]="areAllUsersSelected()" 
                    (change)="toggleAllUsers()"
                    class="w-4 h-4 text-purple-600 focus:ring-purple-600 rounded">
                </div>
              </th>
              <th class="px-4 py-4 text-left text-gray-700">User</th>
              <th class="px-4 py-4 text-left text-gray-700">
                <div class="flex items-center cursor-pointer" (click)="sortBy('email')">
                  Email
                  <i *ngIf="sortField === 'email'" 
                     [class]="sortOrder === 'asc' ? 'fas fa-sort-up ml-1' : 'fas fa-sort-down ml-1'"></i>
                  <i *ngIf="sortField !== 'email'" class="fas fa-sort ml-1 text-gray-300"></i>
                </div>
              </th>
              <th class="px-4 py-4 text-left text-gray-700 hidden md:table-cell">
                <div class="flex items-center cursor-pointer" (click)="sortBy('role')">
                  Role
                  <i *ngIf="sortField === 'role'" 
                     [class]="sortOrder === 'asc' ? 'fas fa-sort-up ml-1' : 'fas fa-sort-down ml-1'"></i>
                  <i *ngIf="sortField !== 'role'" class="fas fa-sort ml-1 text-gray-300"></i>
                </div>
              </th>
              <th class="px-4 py-4 text-left text-gray-700 hidden sm:table-cell">
                <div class="flex items-center cursor-pointer" (click)="sortBy('status')">
                  Status
                  <i *ngIf="sortField === 'status'" 
                     [class]="sortOrder === 'asc' ? 'fas fa-sort-up ml-1' : 'fas fa-sort-down ml-1'"></i>
                  <i *ngIf="sortField !== 'status'" class="fas fa-sort ml-1 text-gray-300"></i>
                </div>
              </th>
              <th class="px-4 py-4 text-left text-gray-700 hidden lg:table-cell">
                <div class="flex items-center cursor-pointer" (click)="sortBy('createdAt')">
                  Created
                  <i *ngIf="sortField === 'createdAt'" 
                     [class]="sortOrder === 'asc' ? 'fas fa-sort-up ml-1' : 'fas fa-sort-down ml-1'"></i>
                  <i *ngIf="sortField !== 'createdAt'" class="fas fa-sort ml-1 text-gray-300"></i>
                </div>
              </th>
              <th class="px-4 py-4 text-left text-gray-700 hidden md:table-cell">Verification</th>
              <th class="px-4 py-4 text-left text-gray-700">Actions</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngIf="filteredUsers.length > 0; else noUsers">
              <tr *ngFor="let user of filteredUsers" class="border-b border-gray-200 hover:bg-slate-50 transition-colors">
                <td class="px-4 py-4">
                  <input 
                    type="checkbox" 
                    [checked]="isUserSelected(user.id)" 
                    (change)="toggleUserSelection(user)"
                    class="w-4 h-4 text-purple-600 focus:ring-purple-600 rounded">
                </td>
                <td class="px-4 py-4">
                  <div class="flex items-center">
                    <div class="w-10 h-10 flex-shrink-0 mr-3">
                      <div class="w-full h-full rounded-full bg-gray-300 flex items-center justify-center text-gray-600 uppercase font-bold">
                        {{user.firstName?.charAt(0) || '?'}}{{user.lastName?.charAt(0) || '?'}}
                      </div>
                    </div>
                    <div>
                      <div class="font-medium text-gray-800">{{user.firstName}} {{user.lastName}}</div>
                      <div class="text-sm text-gray-500">ID: {{user.id.substring(0, 8)}}</div>
                    </div>
                  </div>
                </td>
                <td class="px-4 py-4 text-gray-600">{{user.email}}</td>
                <td class="px-4 py-4 hidden md:table-cell">
                  <span [ngClass]="{
                    'bg-purple-100 text-purple-600': user.role === 'admin',
                    'bg-blue-100 text-blue-600': user.role === 'employer',
                    'bg-green-100 text-green-600': user.role === 'jobseeker'
                  }" class="px-2 py-1 rounded-full text-xs font-medium">
                    {{user.role | titlecase}}
                  </span>
                </td>
                <td class="px-4 py-4 hidden sm:table-cell">
                  <span [ngClass]="{
                    'bg-green-100 text-green-600': user.status === 'active',
                    'bg-yellow-100 text-yellow-600': user.status === 'pending',
                    'bg-red-100 text-red-600': user.status === 'suspended',
                    'bg-gray-100 text-gray-600': user.status === 'inactive'
                  }" class="px-2 py-1 rounded-full text-xs font-medium">
                    {{user.status | titlecase}}
                  </span>
                </td>
                <td class="px-4 py-4 text-gray-600 hidden lg:table-cell">{{user.createdAt | date:'MMM d, y'}}</td>
                <td class="px-4 py-4 hidden md:table-cell">
                  <span *ngIf="user.isVerified" class="flex items-center text-green-600">
                    <i class="fas fa-check-circle mr-1"></i> Verified
                  </span>
                  <span *ngIf="!user.isVerified" class="flex items-center text-orange-500 cursor-pointer hover:text-orange-600" (click)="verifyUser(user)">
                    <i class="fas fa-exclamation-circle mr-1"></i> Unverified
                  </span>
                </td>
                <td class="px-4 py-4 relative">
                  <button 
                    (click)="toggleActionMenu(user.id)" 
                    class="text-gray-500 hover:text-purple-600 focus:outline-none">
                    <i class="fas fa-ellipsis-v"></i>
                  </button>
                  <!-- Action dropdown menu -->
                  <div *ngIf="activeActionMenu === user.id" 
                       class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg z-20 py-1 border border-gray-200">
                    <a (click)="viewUserDetails(user)" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer">
                      <i class="fas fa-eye mr-2"></i> View Details
                    </a>
                    <a (click)="editUser(user)" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer">
                      <i class="fas fa-edit mr-2"></i> Edit User
                    </a>
                    <a (click)="resetPassword(user)" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer">
                      <i class="fas fa-key mr-2"></i> Reset Password
                    </a>
                    <div class="border-t border-gray-100 my-1"></div>
                    <a (click)="changeRole(user)" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer">
                      <i class="fas fa-user-tag mr-2"></i> Change Role
                    </a>
                    <a *ngIf="user.status !== 'suspended'" (click)="suspendUser(user)" class="block px-4 py-2 text-yellow-600 hover:bg-yellow-50 cursor-pointer">
                      <i class="fas fa-ban mr-2"></i> Suspend User
                    </a>
                    <a *ngIf="user.status === 'suspended'" (click)="activateUser(user)" class="block px-4 py-2 text-green-600 hover:bg-green-50 cursor-pointer">
                      <i class="fas fa-check-circle mr-2"></i> Activate User
                    </a>
                    <div class="border-t border-gray-100 my-1"></div>
                    <a (click)="deleteUser(user)" class="block px-4 py-2 text-red-600 hover:bg-red-50 cursor-pointer">
                      <i class="fas fa-trash-alt mr-2"></i> Delete User
                    </a>
                  </div>
                </td>
              </tr>
            </ng-container>
            <ng-template #noUsers>
              <tr>
                <td colspan="8" class="px-4 py-8 text-center text-gray-500">
                  <div class="flex flex-col items-center">
                    <i class="fas fa-users text-4xl mb-3 text-gray-300"></i>
                    <p class="text-lg font-medium">No users found</p>
                    <p class="text-sm max-w-md mx-auto mt-1">There are no users matching your current filters. Try adjusting your search criteria or reset filters.</p>
                    <button 
                      (click)="resetFilters()" 
                      class="mt-3 px-4 py-2 bg-purple-100 text-purple-700 rounded-md hover:bg-purple-200 transition-colors">
                      Reset Filters
                    </button>
                  </div>
                </td>
              </tr>
            </ng-template>
          </tbody>
        </table>
        
        <!-- Pagination -->
        <div class="flex flex-col sm:flex-row justify-between items-center px-4 py-3 bg-white border-t border-gray-200">
          <div class="mb-3 sm:mb-0 text-sm text-gray-600">
            Showing <span class="font-medium">{{filteredUsers.length > 0 ? (currentPage - 1) * pageSize + 1 : 0}}</span> to 
            <span class="font-medium">{{Math.min(currentPage * pageSize, totalUsers)}}</span> of 
            <span class="font-medium">{{totalUsers}}</span> users
          </div>
          <div class="pagination-controls flex space-x-1">
            <button 
              [disabled]="currentPage === 1"
              (click)="goToPage(currentPage - 1)" 
              class="pagination-btn px-3 py-1 rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-chevron-left"></i>
            </button>
            <ng-container *ngFor="let page of getPaginationArray()">
              <button 
                *ngIf="page !== '...'"
                [class.bg-purple-600]="page === currentPage"
                [class.text-white]="page === currentPage"
                [class.bg-white]="page !== currentPage"
                [class.text-gray-700]="page !== currentPage"
                (click)="goToPage(page)"
                class="pagination-btn px-3 py-1 rounded-md border border-gray-300 hover:bg-gray-50">
                {{page}}
              </button>
              <span *ngIf="page === '...'" class="px-3 py-1">{{page}}</span>
            </ng-container>
            <button 
              [disabled]="currentPage === getTotalPages()"
              (click)="goToPage(currentPage + 1)" 
              class="pagination-btn px-3 py-1 rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- User Form Modal -->
<div *ngIf="showModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-auto overflow-hidden animate-fadeIn">
    <div class="p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">{{ isEditMode ? 'Edit User' : 'Add New User' }}</h2>
        <button (click)="closeModal()" class="text-gray-500 hover:text-gray-700 focus:outline-none">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form [formGroup]="userForm" (ngSubmit)="saveUser()">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
          <div class="form-group">
            <label for="firstName" class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
            <input 
              type="text" 
              id="firstName" 
              formControlName="firstName" 
              class="w-full p-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent"
              [ngClass]="{'border-red-500': userForm.get('firstName')?.invalid && userForm.get('firstName')?.touched}">
            <div *ngIf="userForm.get('firstName')?.invalid && userForm.get('firstName')?.touched" class="text-red-500 text-sm mt-1">
              First name is required
            </div>
          </div>
          
          <div class="form-group">
            <label for="lastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
            <input 
              type="text" 
              id="lastName" 
              formControlName="lastName" 
              class="w-full p-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent"
              [ngClass]="{'border-red-500': userForm.get('lastName')?.invalid && userForm.get('lastName')?.touched}">
            <div *ngIf="userForm.get('lastName')?.invalid && userForm.get('lastName')?.touched" class="text-red-500 text-sm mt-1">
              Last name is required
            </div>
          </div>
        </div>
        
        <div class="form-group mb-4">
          <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
          <input 
            type="email" 
            id="email" 
            formControlName="email" 
            class="w-full p-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent"
            [ngClass]="{'border-red-500': userForm.get('email')?.invalid && userForm.get('email')?.touched}">
          <div *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="userForm.get('email')?.errors?.['required']">Email is required</span>
            <span *ngIf="userForm.get('email')?.errors?.['email']">Please enter a valid email address</span>
          </div>
        </div>
        
        <div class="form-group mb-4" *ngIf="!isEditMode">
          <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
          <div class="relative">
            <input 
              [type]="showPassword ? 'text' : 'password'" 
              id="password" 
              formControlName="password" 
              class="w-full p-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent"
              [ngClass]="{'border-red-500': userForm.get('password')?.invalid && userForm.get('password')?.touched}">
            <button 
              type="button" 
              (click)="togglePasswordVisibility()" 
              class="absolute right-3 top-3 text-gray-500 hover:text-gray-700 focus:outline-none">
              <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
            </button>
          </div>
          <div *ngIf="userForm.get('password')?.invalid && userForm.get('password')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="userForm.get('password')?.errors?.['required']">Password is required</span>
            <span *ngIf="userForm.get('password')?.errors?.['minlength']">Password must be at least 6 characters</span>
          </div>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
          <div class="form-group">
            <label for="role" class="block text-sm font-medium text-gray-700 mb-1">Role</label>
            <select 
              id="role" 
              formControlName="role" 
              class="w-full p-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-white">
              <option value="jobseeker">Job Seeker</option>
              <option value="employer">Employer</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
            <select 
              id="status" 
              formControlName="status" 
              class="w-full p-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-white">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="pending">Pending</option>
              <option value="suspended">Suspended</option>
            </select>
          </div>
        </div>
        
        <div class="form-group mb-6">
          <label class="flex items-center">
            <input 
              type="checkbox" 
              formControlName="isVerified" 
              class="w-4 h-4 text-purple-600 focus:ring-purple-600 rounded">
            <span class="ml-2 text-sm text-gray-700">User is verified</span>
          </label>
        </div>
        
        <div class="flex justify-end gap-3">
          <button 
            type="button" 
            (click)="closeModal()" 
            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
            Cancel
          </button>
          <button 
            type="submit" 
            [disabled]="userForm.invalid" 
            class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            {{ isEditMode ? 'Update User' : 'Create User' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- User Details Modal -->
<div *ngIf="showDetailsModal && selectedUser" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 overflow-y-auto">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl mx-auto max-h-[90vh] overflow-hidden animate-fadeIn">
    <div class="flex justify-between items-center p-6 border-b border-gray-200">
      <h2 class="text-xl font-bold text-gray-800">User Details</h2>
      <button (click)="closeDetailsModal()" class="text-gray-500 hover:text-gray-700 focus:outline-none">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="overflow-y-auto max-h-[calc(90vh-120px)]">
      <!-- User Profile Header -->
      <div class="p-6 border-b border-gray-200">
        <div class="flex flex-col sm:flex-row items-center sm:items-start">
          <div class="w-20 h-20 flex-shrink-0 mb-4 sm:mr-6 sm:mb-0">
            <div class="w-full h-full rounded-full bg-gray-300 flex items-center justify-center text-gray-600 uppercase font-bold text-2xl">
              {{selectedUser.lastName.charAt(0) || '?'}}{{selectedUser.lastName.charAt(0) || '?'}}
            </div>
          </div>
          <div class="text-center sm:text-left">
            <h3 class="text-xl font-bold text-gray-800">{{selectedUser.firstName}} {{selectedUser.lastName}}</h3>
            <p class="text-gray-600 mb-1">{{selectedUser.email}}</p>
            <div class="flex flex-wrap gap-2 justify-center sm:justify-start mt-2">
              <span [ngClass]="{
                'bg-purple-100 text-purple-600': selectedUser.role === 'admin',
                'bg-blue-100 text-blue-600': selectedUser.role === 'employer',
                'bg-green-100 text-green-600': selectedUser.role === 'jobseeker'
              }" class="px-2 py-1 rounded-full text-xs font-medium">
                {{selectedUser.role | titlecase}}
              </span>
              <span [ngClass]="{
                'bg-green-100 text-green-600': selectedUser.status === 'active',
                'bg-yellow-100 text-yellow-600': selectedUser.status === 'pending',
                'bg-red-100 text-red-600': selectedUser.status === 'suspended',
                'bg-gray-100 text-gray-600': selectedUser.status === 'inactive'
              }" class="px-2 py-1 rounded-full text-xs font-medium">
                {{selectedUser.status | titlecase}}
              </span>
              <span *ngIf="selectedUser.isVerified" class="bg-blue-100 text-blue-600 px-2 py-1 rounded-full text-xs font-medium">
                <i class="fas fa-check-circle mr-1"></i> Verified
              </span>
              <span *ngIf="!selectedUser.isVerified" class="bg-orange-100 text-orange-600 px-2 py-1 rounded-full text-xs font-medium">
                <i class="fas fa-exclamation-circle mr-1"></i> Unverified
              </span>
            </div>
          </div>
          <div class="mt-4 sm:mt-0 sm:ml-auto flex gap-2">
            <button 
              (click)="editUser(selectedUser)" 
              class="px-3 py-1.5 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors">
              <i class="fas fa-edit mr-1"></i> Edit User
            </button>
            <button 
              (click)="resetPassword(selectedUser)" 
              class="px-3 py-1.5 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors">
              <i class="fas fa-key mr-1"></i> Reset Password
            </button>
          </div>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-6 text-sm">
          <div>
            <p class="text-gray-500">User ID</p>
            <p class="font-medium">{{selectedUser.id}}</p>
          </div>
          <div>
            <p class="text-gray-500">Created At</p>
            <p class="font-medium">{{selectedUser.createdAt | date:'MMM d, y, h:mm a'}}</p>
          </div>
          <div>
            <p class="text-gray-500">Last Updated</p>
            <p class="font-medium">{{selectedUser.updatedAt | date:'MMM d, y, h:mm a'}}</p>
          </div>
          <div>
            <p class="text-gray-500">Last Active</p>
            <p class="font-medium">{{selectedUser.lastActive ? (selectedUser.lastActive | date:'MMM d, y, h:mm a') : 'Never'}}</p>
          </div>
        </div>
      </div>
      
      <!-- Tabs -->
      <div class="border-b border-gray-200">
        <div class="flex overflow-x-auto">
          <button 
            [class.border-purple-600]="currentTab === 'activity'" 
            [class.text-purple-600]="currentTab === 'activity'"
            [class.border-transparent]="currentTab !== 'activity'"
            (click)="currentTab = 'activity'" 
            class="py-3 px-6 border-b-2 font-medium text-sm hover:text-purple-600 focus:outline-none">
            Activity Log
          </button>
          <button 
            [class.border-purple-600]="currentTab === 'security'" 
            [class.text-purple-600]="currentTab === 'security'"
            [class.border-transparent]="currentTab !== 'security'"
            (click)="currentTab = 'security'" 
            class="py-3 px-6 border-b-2 font-medium text-sm hover:text-purple-600 focus:outline-none">
            Security & Sessions
          </button>
          <button 
            [class.border-purple-600]="currentTab === 'notes'" 
            [class.text-purple-600]="currentTab === 'notes'"
            [class.border-transparent]="currentTab !== 'notes'"
            (click)="currentTab = 'notes'" 
            class="py-3 px-6 border-b-2 font-medium text-sm hover:text-purple-600 focus:outline-none">
            Admin Notes
          </button>
        </div>
      </div>
      
      <!-- Tab Content -->
      <div class="p-6">
        <!-- Activity Log Tab -->
        <div *ngIf="currentTab === 'activity'">
          <h3 class="text-lg font-medium text-gray-800 mb-4">User Activity Log</h3>
          
          <div *ngIf="userActivityLog.length === 0" class="text-center py-8">
            <i class="fas fa-history text-4xl text-gray-300 mb-3"></i>
            <p class="text-gray-500">No activity records available for this user</p>
          </div>
          
          <div *ngIf="userActivityLog.length > 0" class="space-y-3">
            <div *ngFor="let activity of userActivityLog" class="p-3 bg-gray-50 rounded-lg">
              <div class="flex justify-between items-start">
                <span class="font-medium">{{activity.type}}</span>
                <span class="text-sm text-gray-500">{{activity.createdAt | date:'MMM d, y, h:mm a'}}</span>
              </div>
              <p class="text-gray-600 mt-1">{{activity.description}}</p>
              <div *ngIf="activity.metadata" class="mt-2 text-sm text-gray-500">
                <div *ngFor="let item of activity.metadata | keyvalue">
                  <span class="font-medium">{{item.key}}</span>: {{item.value}}
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Security & Sessions Tab -->
        <div *ngIf="currentTab === 'security'">
          <div class="mb-6">
            <h3 class="text-lg font-medium text-gray-800 mb-4">Account Security</h3>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div class="p-4 border border-gray-200 rounded-lg">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-gray-700 font-medium">Two-Factor Authentication</span>
                  <div class="relative inline-block w-10 mr-2 align-middle select-none">
                    <input 
                      type="checkbox" 
                      [checked]="selectedUser.twoFactorEnabled"
                      (change)="toggleTwoFactor()"
                      id="toggle-2fa" 
                      class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                    <label for="toggle-2fa" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                  </div>
                </div>
                <p class="text-sm text-gray-500">
                  {{selectedUser.twoFactorEnabled ? 'User has enabled two-factor authentication for increased account security.' : 'Two-factor authentication is not enabled for this user.'}}
                </p>
              </div>
              
              <div class="p-4 border border-gray-200 rounded-lg">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-gray-700 font-medium">Password Status</span>
                  <button 
                    (click)="resetPassword(selectedUser)" 
                    class="px-2 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-sm">
                    Reset
                  </button>
                </div>
                <p class="text-sm text-gray-500">
                  Last changed: {{selectedUser.passwordLastChanged ? (selectedUser.passwordLastChanged | date:'MMM d, y') : 'Never'}}
                </p>
              </div>
            </div>
            
            <div class="mt-4 flex gap-2">
              <button 
                (click)="lockAccount()" 
                class="px-3 py-1.5 bg-yellow-500 text-white rounded-md hover:bg-yellow-600 transition-colors">
                <i class="fas fa-lock mr-1"></i> Lock Account
              </button>
              <button 
                (click)="forceLogout()" 
                class="px-3 py-1.5 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors">
                <i class="fas fa-sign-out-alt mr-1"></i> Force Logout
              </button>
              <button 
                (click)="deleteUserData()" 
                class="px-3 py-1.5 bg-gray-800 text-white rounded-md hover:bg-gray-900 transition-colors">
                <i class="fas fa-trash-alt mr-1"></i> Delete Data
              </button>
            </div>
          </div>
          
          <div>
            <h3 class="text-lg font-medium text-gray-800 mb-4">Active Sessions</h3>
            
            <div *ngIf="userSessions.length === 0" class="text-center py-6">
              <i class="fas fa-laptop text-4xl text-gray-300 mb-3"></i>
              <p class="text-gray-500">No active sessions for this user</p>
            </div>
            
            <div *ngIf="userSessions.length > 0" class="space-y-3">
              <div *ngFor="let session of userSessions" class="p-4 border border-gray-200 rounded-lg">
                <div class="flex justify-between items-start">
                  <div>
                    <div class="flex items-center">
                      <i class="fas fa-desktop mr-2 text-gray-500"></i>
                      <span class="font-medium">{{session.device}}</span>
                      <span *ngIf="session.active" class="ml-2 px-2 py-0.5 bg-green-100 text-green-600 text-xs rounded-full">Active</span>
                    </div>
                    <div class="mt-1 text-sm text-gray-500">
                      <p>{{session.location}} • IP: {{session.ip}}</p>
                      <p>Last active: {{session.lastActive | date:'MMM d, y, h:mm a'}}</p>
                    </div>
                  </div>
                  <button 
                    *ngIf="session.active"
                    (click)="terminateSession(session)" 
                    class="px-2 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200 text-sm">
                    Terminate
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Admin Notes Tab -->
        <div *ngIf="currentTab === 'notes'">
          <h3 class="text-lg font-medium text-gray-800 mb-4">Admin Notes</h3>
          
          <form [formGroup]="noteForm" (ngSubmit)="addNote()" class="mb-6 p-4 bg-gray-50 rounded-lg">
            <div class="mb-3">
              <label for="noteTitle" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
              <input 
                type="text" 
                id="noteTitle" 
                formControlName="title" 
                class="w-full p-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent"
                placeholder="Note title">
            </div>
            <div class="mb-3">
              <label for="noteContent" class="block text-sm font-medium text-gray-700 mb-1">Content</label>
              <textarea 
                id="noteContent" 
                formControlName="content" 
                rows="3" 
                class="w-full p-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent"
                placeholder="Add notes about this user"></textarea>
            </div>
            <button 
              type="submit" 
              [disabled]="noteForm.invalid" 
              class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-plus mr-1"></i> Add Note
            </button>
          </form>
          
          <div *ngIf="adminNotes.length === 0" class="text-center py-6">
            <i class="fas fa-sticky-note text-4xl text-gray-300 mb-3"></i>
            <p class="text-gray-500">No admin notes for this user</p>
          </div>
          
          <div *ngIf="adminNotes.length > 0" class="space-y-4">
            <div *ngFor="let note of adminNotes" class="p-4 border border-gray-200 rounded-lg">
              <div class="flex justify-between items-start">
                <div>
                  <h4 class="font-medium text-gray-800">{{note.title}}</h4>
                  <p class="text-sm text-gray-500 mt-1">
                    By {{note.adminName}} • {{note.createdAt | date:'MMM d, y, h:mm a'}}
                  </p>
                </div>
                <button 
                  (click)="deleteNote(note)" 
                  class="text-red-500 hover:text-red-600">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
              <p class="mt-2 text-gray-600">{{note.content}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div *ngIf="showConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-auto overflow-hidden animate-fadeIn">
    <div class="p-6">
      <div class="mb-4">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full" 
             [ngClass]="{
               'bg-red-100': confirmModalType === 'delete',
               'bg-yellow-100': confirmModalType === 'suspend',
               'bg-green-100': confirmModalType === 'activate',
               'bg-blue-100': confirmModalType === 'other'
             }">
          <i class="fas" 
             [ngClass]="{
               'fa-trash-alt text-red-600': confirmModalType === 'delete',
               'fa-ban text-yellow-600': confirmModalType === 'suspend',
               'fa-check-circle text-green-600': confirmModalType === 'activate',
               'fa-exclamation-circle text-blue-600': confirmModalType === 'other'
             }"></i>
        </div>
        <h3 class="mt-3 text-lg font-medium text-gray-900 text-center">{{confirmModalTitle}}</h3>
        <p class="mt-2 text-gray-600 text-center">{{confirmModalMessage}}</p>
      </div>
      
      <div class="flex justify-end gap-3 mt-6">
        <button 
          type="button" 
          (click)="closeConfirmModal()" 
          class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
          Cancel
        </button>
        <button 
          type="button" 
          (click)="confirmAction()" 
          class="px-4 py-2 rounded-lg text-white transition-colors"
          [ngClass]="{
            'bg-red-600 hover:bg-red-700': confirmModalType === 'delete',
            'bg-yellow-500 hover:bg-yellow-600': confirmModalType === 'suspend',
            'bg-green-600 hover:bg-green-700': confirmModalType === 'activate',
            'bg-purple-600 hover:bg-purple-700': confirmModalType === 'other'
          }">
          {{confirmButtonText}}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Notifications -->
<div *ngIf="showToast" 
     class="fixed bottom-5 right-5 max-w-sm w-full bg-white rounded-lg shadow-lg border-l-4 overflow-hidden animate-slideUp z-50"
     [ngClass]="{
       'border-green-500': toastType === 'success',
       'border-yellow-500': toastType === 'warning',
       'border-red-500': toastType === 'error',
       'border-blue-500': toastType === 'info'
     }">
  <div class="p-4 pr-12">
    <button (click)="closeToast()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
      <i class="fas fa-times"></i>
    </button>
    <div class="flex items-start">
      <div class="flex-shrink-0">
        <i class="fas text-lg"
           [ngClass]="{
             'fa-check-circle text-green-500': toastType === 'success',
             'fa-exclamation-circle text-yellow-500': toastType === 'warning',
             'fa-times-circle text-red-500': toastType === 'error',
             'fa-info-circle text-blue-500': toastType === 'info'
           }"></i>
      </div>
      <div class="ml-3">
        <p class="text-sm font-medium text-gray-900">{{toastTitle}}</p>
        <p class="mt-1 text-sm text-gray-500">{{toastMessage}}</p>
      </div>
    </div>
  </div>
  <div class="h-1 bg-gray-200">
    <div class="h-full transition-all duration-200 ease-linear"
         [ngClass]="{
           'bg-green-500': toastType === 'success',
           'bg-yellow-500': toastType === 'warning',
           'bg-red-500': toastType === 'error',
           'bg-blue-500': toastType === 'info'
         }"
         [style.width.%]="toastProgress"></div>
  </div>
</div>